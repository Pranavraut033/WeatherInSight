# StatsD to Prometheus Mapping for Airflow Metrics

mappings:
  # DAG processing metrics
  - match: "airflow.dagrun.*.*.first_task_scheduling_delay"
    name: "airflow_dagrun_first_task_scheduling_delay"
    labels:
      dag_id: "$1"
      run_id: "$2"
  
  - match: "airflow.dagrun.*.success"
    name: "airflow_dagrun_success_total"
    match_type: "counter"
    labels:
      dag_id: "$1"
  
  - match: "airflow.dagrun.*.failed"
    name: "airflow_dagrun_failed_total"
    match_type: "counter"
    labels:
      dag_id: "$1"
  
  - match: "airflow.dagrun.duration.success.*"
    name: "airflow_dagrun_duration_seconds"
    timer_type: "histogram"
    labels:
      dag_id: "$1"
  
  # Task execution metrics
  - match: "airflow.task.*.*.*.success"
    name: "airflow_task_success_total"
    match_type: "counter"
    labels:
      dag_id: "$1"
      task_id: "$2"
      run_id: "$3"
  
  - match: "airflow.task.*.*.*.failed"
    name: "airflow_task_failed_total"
    match_type: "counter"
    labels:
      dag_id: "$1"
      task_id: "$2"
      run_id: "$3"
  
  - match: "airflow.task_instance_duration-seconds.*.*"
    name: "airflow_task_duration_seconds"
    timer_type: "histogram"
    labels:
      dag_id: "$1"
      task_id: "$2"
  
  # Executor metrics
  - match: "airflow.executor.open_slots"
    name: "airflow_executor_open_slots"
  
  - match: "airflow.executor.queued_tasks"
    name: "airflow_executor_queued_tasks"
  
  - match: "airflow.executor.running_tasks"
    name: "airflow_executor_running_tasks"
  
  # Scheduler metrics
  - match: "airflow.scheduler.heartbeat"
    name: "airflow_scheduler_heartbeat"
  
  - match: "airflow.scheduler.tasks.killed_externally"
    name: "airflow_scheduler_tasks_killed_externally_total"
    match_type: "counter"
  
  - match: "airflow.scheduler.tasks.running"
    name: "airflow_scheduler_tasks_running"
  
  - match: "airflow.scheduler.tasks.starving"
    name: "airflow_scheduler_tasks_starving"
  
  # Pool metrics
  - match: "airflow.pool.open_slots.*"
    name: "airflow_pool_open_slots"
    labels:
      pool: "$1"
  
  - match: "airflow.pool.used_slots.*"
    name: "airflow_pool_used_slots"
    labels:
      pool: "$1"
  
  - match: "airflow.pool.starving_tasks.*"
    name: "airflow_pool_starving_tasks"
    labels:
      pool: "$1"
